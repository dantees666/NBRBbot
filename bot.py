import config
import telebot
from telebot import types
from fuzzywuzzy import fuzz

bot = telebot.TeleBot(config.token)

FAQ_ANSWERS = {
    "–æ –Ω–∞—Å": "üìñ <b>–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –†–µ—Å–ø—É–±–ª–∏–∫–∏ –ë—É—Ä—è—Ç–∏—è</b> ‚Äî —Ü–µ–Ω—Ç—Ä –∑–Ω–∞–Ω–∏–π, –∫—É–ª—å—Ç—É—Ä—ã –∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–π.\n\n"
             "–ê–¥—Ä–µ—Å: –£–ª–∞–Ω-–£–¥—ç, —É–ª. –õ–µ–Ω–∏–Ω–∞, 50.\n"
             "–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã: –ü–Ω-–ü—Ç —Å 9:00 –¥–æ 18:00, –°–± —Å 10:00 –¥–æ 17:00, –í—Å ‚Äî –≤—ã—Ö–æ–¥–Ω–æ–π.\n\n"
             "–ü–æ–¥—Ä–æ–±–Ω–µ–µ –Ω–∞ <a href='https://nbrb.ru/'>–Ω–∞—à–µ–º —Å–∞–π—Ç–µ</a>.",
    "–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è": "üéâ <b>–ù–∞—à–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:</b>\n\n"
                   "üìÖ –õ–µ–∫—Ü–∏–∏, –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã, –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –∫–Ω–∏–≥, —Ä–µ–ø–µ—Ç–∏—Ü–∏–∏ —Ö–æ—Ä–∞ –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ.\n\n"
                   "üìå –°–ª–µ–¥–∏—Ç–µ –∑–∞ –∞—Ñ–∏—à–µ–π –Ω–∞ <a href='https://nbrbru.tmweb.ru/affiche/'>–Ω–∞—à–µ–º —Å–∞–π—Ç–µ</a> "
                   "–∏–ª–∏ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö.\n\n"
                   "üîñ –ù–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–æ–±—ã—Ç–∏—è –º–æ–∂–Ω–æ –ø–æ–ø–∞—Å—Ç—å –ø–æ –ü—É—à–∫–∏–Ω—Å–∫–æ–π –∫–∞—Ä—Ç–µ.",
    "—ç–∫—Å–∫—É—Ä—Å–∏—è": "üö∂‚Äç‚ôÇÔ∏è <b>–ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —ç–∫—Å–∫—É—Ä—Å–∏—é?</b>\n\n"
                 "–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —ç–∫—Å–∫—É—Ä—Å–∏—é –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π –∑–æ–Ω–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–ª–∏ –æ–Ω–ª–∞–π–Ω –ø–æ "
                 "<a href='https://iframeab-pre6061.intickets.ru/event/12331186'>—Å—Å—ã–ª–∫–µ</a>.\n\n"
                 "–≠–∫—Å–∫—É—Ä—Å–∏–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —Å –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞ –ø–æ —á–µ—Ç–≤–µ—Ä–≥ –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é.",
    "—á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã": "üìö <b>–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã:</b>\n\n"
                                 "1. <b>–ö—Ç–æ –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è?</b> \n"
                                 "–ì—Ä–∞–∂–¥–∞–Ω–µ –†–§ –∏ –∏–Ω–æ—Å—Ç—Ä–∞–Ω—Ü—ã —Å—Ç–∞—Ä—à–µ 14 –ª–µ—Ç —Å –ø–∞—Å–ø–æ—Ä—Ç–æ–º.\n\n"
                                 "2. <b>–ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è?</b>\n"
                                 "–õ–∏—á–Ω–æ –Ω–∞ —Å—Ç–æ–π–∫–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–ª–∏ —á–µ—Ä–µ–∑ –ì–æ—Å—É—Å–ª—É–≥–∏. "
                                 "<a href='https://nbrbru.tmweb.ru/info/kak-zapisatsa/'>–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>\n\n"
                                 "3. <b>–ß—Ç–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Å —á–∏—Ç–∞—Ç–µ–ª—å—Å–∫–∏–º –±–∏–ª–µ—Ç–æ–º?</b>\n"
                                 "–ë—Ä–∞—Ç—å –∫–Ω–∏–≥–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ä–µ—Å—É—Ä—Å–∞–º–∏, —Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞ –ü–ö.\n\n"
                                 "4. <b>–ö–∞–∫ –∑–∞–∫–∞–∑–∞—Ç—å –∫–Ω–∏–≥–∏?</b>\n"
                                 "–í —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ (—Ç—Ä–µ–±—É–µ—Ç—Å—è —á–∏—Ç–∞—Ç–µ–ª—å—Å–∫–∏–π –±–∏–ª–µ—Ç). "
                                 "<a href='http://nbrbru.tmweb.ru/info/kak-zakazat-knigu/'>–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>\n\n"
                                 "5. <b>–ö–∞–∫ –ø—Ä–æ–¥–ª–∏—Ç—å –∫–Ω–∏–≥–∏?</b>\n"
                                 "–î–æ 5 –∫–Ω–∏–≥ –Ω–∞ 15 –¥–Ω–µ–π, –º–æ–∂–Ω–æ –ø—Ä–æ–¥–ª–∏—Ç—å 2 —Ä–∞–∑–∞. "
                                 "<a href='http://nbrbru.tmweb.ru/info/kak-prodlit-knigu'>–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>\n\n"
                                 "6. <b>–ß—Ç–æ –º–æ–∂–Ω–æ –±–µ–∑ –±–∏–ª–µ—Ç–∞?</b>\n"
                                 "–ü–æ—Å–µ—Ç–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, —ç–∫—Å–∫—É—Ä—Å–∏–∏, –∫—É–ø–∏—Ç—å –∫–Ω–∏–≥–∏.\n\n"
                                 "7. <b>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏:</b>\n"
                                 "–ö—Å–µ—Ä–æ–∫–æ–ø–∏—è, –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã –∫–Ω–∏–≥."
}

def get_closest_match(user_input):
    best_match = None
    highest_score = 0
    for question in FAQ_ANSWERS:
        similarity = fuzz.partial_ratio(user_input.lower(), question.lower())
        if similarity > highest_score:
            best_match = question
            highest_score = similarity
    return best_match if highest_score > 60 else None  # –ü–æ—Ä–æ–≥ 60% –¥–ª—è "–ø–æ—Ö–æ–∂–µ—Å—Ç–∏"


# –ö–æ–º–∞–Ω–¥–∞ /start
@bot.message_handler(commands=['go', 'start'])
def welcome(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)

    item5 = types.KeyboardButton("–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã")
    item4 = types.KeyboardButton("–ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —ç–∫—Å–∫—É—Ä—Å–∏—é?")
    item2 = types.KeyboardButton("–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è")
    item1 = types.KeyboardButton("–û –Ω–∞—Å")

    markup.add(item1, item2, item4, item5)

    bot.send_message(
        message.chat.id,
        f"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {message.from_user.first_name}!\n\n"
        f"–Ø - <b>{bot.get_me().first_name}</b>, –±–æ—Ç –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –†–µ—Å–ø—É–±–ª–∏–∫–∏ –ë—É—Ä—è—Ç–∏—è.\n\n"
        "–Ø –ø–æ–º–æ–≥—É –≤–∞–º —É–∑–Ω–∞—Ç—å –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö –Ω–∞—à–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, "
        "–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —ç–∫—Å–∫—É—Ä—Å–∏–∏.\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –≤–∞—Å –ø—É–Ω–∫—Ç –≤ –º–µ–Ω—é üëá",
        parse_mode='html', reply_markup=markup
    )

@bot.message_handler(content_types=['text'])
def handle_text(message):
    user_input = message.text.strip()
    match = get_closest_match(user_input)

    if match:
        bot.send_message(
            message.chat.id,
            FAQ_ANSWERS[match],
            parse_mode='html'
        )
    else:
        bot.send_message(
            message.chat.id,
            "ü§î –ò–∑–≤–∏–Ω–∏—Ç–µ, —è –Ω–µ –ø–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –∏–∑ –º–µ–Ω—é."
        )

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
if __name__ == "__main__":
    try:
        bot.polling(none_stop=True)
    except ConnectionError as e:
        print('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ', e)
    except Exception as r:
        print("–ù–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: ", r)
    finally:
        print("–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞.")
