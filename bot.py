import config
import telebot
from telebot import types
from fuzzywuzzy import fuzz

bot = telebot.TeleBot(config.token)

# –°–ª–æ–≤–∞—Ä—å –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ —Å —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏
FAQ_ANSWERS = {
    "–æ –Ω–∞—Å": {
        "answer": "üìñ <b>–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –†–µ—Å–ø—É–±–ª–∏–∫–∏ –ë—É—Ä—è—Ç–∏—è</b> ‚Äî —Ü–µ–Ω—Ç—Ä –∑–Ω–∞–Ω–∏–π, –∫—É–ª—å—Ç—É—Ä—ã –∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–π.\n\n"
                  "–ê–¥—Ä–µ—Å: –£–ª–∞–Ω-–£–¥—ç, —É–ª. –õ–µ–Ω–∏–Ω–∞, 50.\n"
                  "–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã: –ü–Ω-–ü—Ç —Å 9:00 –¥–æ 18:00, –°–± —Å 10:00 –¥–æ 17:00, –í—Å ‚Äî –≤—ã—Ö–æ–¥–Ω–æ–π.\n\n"
                  "–ü–æ–¥—Ä–æ–±–Ω–µ–µ –Ω–∞ <a href='https://nbrb.ru/'>–Ω–∞—à–µ–º —Å–∞–π—Ç–µ</a>.",
        "synonyms": ["–æ –Ω–∞—Å", "—á—Ç–æ —ç—Ç–æ –∑–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞", "—Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ"]
    },
    "—á–∞—Å—ã —Ä–∞–±–æ—Ç—ã": {
        "answer": "üìÖ <b>–ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:</b>\n\n"
                  "–ü–Ω-–ü—Ç: —Å 9:00 –¥–æ 18:00\n"
                  "–°–±: —Å 10:00 –¥–æ 17:00\n"
                  "–í—Å: –≤—ã—Ö–æ–¥–Ω–æ–π.\n\n"
                  "–ü—Ä–∏—Ö–æ–¥–∏—Ç–µ –≤ –ª—é–±–æ–µ —É–¥–æ–±–Ω–æ–µ –¥–ª—è –≤–∞—Å –≤—Ä–µ–º—è!",
        "synonyms": ["—á–∞—Å—ã —Ä–∞–±–æ—Ç—ã", "–≤–æ —Å–∫–æ–ª—å–∫–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞", "–¥–æ —Å–∫–æ–ª—å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∞",
                     "–≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –±–∏–±–ª–∏–æ—Ç–µ–∫–∏", "–∫–æ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∞"]
    },
    "–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è": {
        "answer": "üéâ <b>–ù–∞—à–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:</b>\n\n"
                  "üìÖ –õ–µ–∫—Ü–∏–∏, –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã, –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –∫–Ω–∏–≥, —Ä–µ–ø–µ—Ç–∏—Ü–∏–∏ —Ö–æ—Ä–∞ –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ.\n\n"
                  "üìå –°–ª–µ–¥–∏—Ç–µ –∑–∞ –∞—Ñ–∏—à–µ–π –Ω–∞ <a href='https://nbrbru.tmweb.ru/affiche/'>–Ω–∞—à–µ–º —Å–∞–π—Ç–µ</a>.",
        "synonyms": ["–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è", "–∫–∞–∫–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –ø—Ä–æ—Ö–æ–¥—è—Ç", "—á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ"]
    },
    "—ç–∫—Å–∫—É—Ä—Å–∏—è": {
        "answer": "üö∂‚Äç‚ôÇÔ∏è <b>–ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —ç–∫—Å–∫—É—Ä—Å–∏—é?</b>\n\n"
                  "–ó–∞–ø–∏—Å—å –≤–æ–∑–º–æ–∂–Ω–∞ –Ω–∞ —Å—Ç–æ–π–∫–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–ª–∏ –æ–Ω–ª–∞–π–Ω –ø–æ "
                  "<a href='https://iframeab-pre6061.intickets.ru/event/12331186'>—Å—Å—ã–ª–∫–µ</a>.",
        "synonyms": ["—ç–∫—Å–∫—É—Ä—Å–∏—è", "–∫–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —ç–∫—Å–∫—É—Ä—Å–∏—é", "–∑–∞–ø–∏—Å—å –Ω–∞ —ç–∫—Å–∫—É—Ä—Å–∏—é"]
    },
    "—á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã": {
        "answer": "üìö <b>–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã:</b>\n\n"
                  "1. <b>–ö—Ç–æ –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è?</b> \n"
                  "–ì—Ä–∞–∂–¥–∞–Ω–µ –†–§ –∏ –∏–Ω–æ—Å—Ç—Ä–∞–Ω—Ü—ã —Å—Ç–∞—Ä—à–µ 14 –ª–µ—Ç —Å –ø–∞—Å–ø–æ—Ä—Ç–æ–º.\n\n"
                  "2. <b>–ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è?</b>\n"
                  "–õ–∏—á–Ω–æ –Ω–∞ —Å—Ç–æ–π–∫–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–ª–∏ —á–µ—Ä–µ–∑ –ì–æ—Å—É—Å–ª—É–≥–∏. "
                  "<a href='https://nbrbru.tmweb.ru/info/kak-zapisatsa/'>–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>\n\n"
                  "3. <b>–ß—Ç–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Å —á–∏—Ç–∞—Ç–µ–ª—å—Å–∫–∏–º –±–∏–ª–µ—Ç–æ–º?</b>\n"
                  "–ë—Ä–∞—Ç—å –∫–Ω–∏–≥–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ä–µ—Å—É—Ä—Å–∞–º–∏, —Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞ –ü–ö.\n\n"
                  "4. <b>–ö–∞–∫ –∑–∞–∫–∞–∑–∞—Ç—å –∫–Ω–∏–≥–∏?</b>\n"
                  "–í —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ (—Ç—Ä–µ–±—É–µ—Ç—Å—è —á–∏—Ç–∞—Ç–µ–ª—å—Å–∫–∏–π –±–∏–ª–µ—Ç). "
                  "<a href='http://nbrbru.tmweb.ru/info/kak-zakazat-knigu/'>–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>\n\n"
                  "5. <b>–ö–∞–∫ –ø—Ä–æ–¥–ª–∏—Ç—å –∫–Ω–∏–≥–∏?</b>\n"
                  "–î–æ 5 –∫–Ω–∏–≥ –Ω–∞ 15 –¥–Ω–µ–π, –º–æ–∂–Ω–æ –ø—Ä–æ–¥–ª–∏—Ç—å 2 —Ä–∞–∑–∞. "
                  "<a href='http://nbrbru.tmweb.ru/info/kak-prodlit-knigu'>–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>\n\n"
                  "6. <b>–ß—Ç–æ –º–æ–∂–Ω–æ –±–µ–∑ –±–∏–ª–µ—Ç–∞?</b>\n"
                  "–ü–æ—Å–µ—Ç–∏—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, —ç–∫—Å–∫—É—Ä—Å–∏–∏, –∫—É–ø–∏—Ç—å –∫–Ω–∏–≥–∏.\n\n"
                  "7. <b>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏:</b>\n"
                  "–ö—Å–µ—Ä–æ–∫–æ–ø–∏—è, –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—ã –∫–Ω–∏–≥.",
        "synonyms": ["—á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã", "–≤–æ–ø—Ä–æ—Å—ã", "–ö—Ç–æ –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è?","–ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è?","–ß—Ç–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Å —á–∏—Ç–∞—Ç–µ–ª—å—Å–∫–∏–º –±–∏–ª–µ—Ç–æ–º?","–ö–∞–∫ –∑–∞–∫–∞–∑–∞—Ç—å –∫–Ω–∏–≥–∏?","–ö–∞–∫ –ø—Ä–æ–¥–ª–∏—Ç—å –∫–Ω–∏–≥–∏?","–ß—Ç–æ –º–æ–∂–Ω–æ –±–µ–∑ –±–∏–ª–µ—Ç–∞?","–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏"]
    }
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–µ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
def get_closest_match(user_input):
    best_match = None
    highest_score = 0
    for key, data in FAQ_ANSWERS.items():
        for synonym in data["synonyms"]:
            similarity = fuzz.partial_ratio(user_input.lower(), synonym.lower())
            if similarity > highest_score:
                best_match = key
                highest_score = similarity
    return best_match if highest_score > 60 else None  # –ü–æ—Ä–æ–≥ 60%

# –ö–æ–º–∞–Ω–¥–∞ /start
@bot.message_handler(commands=['go', 'start'])
def welcome(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    item1 = types.KeyboardButton("–û –Ω–∞—Å")
    item2 = types.KeyboardButton("–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è")
    item3 = types.KeyboardButton("–ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —ç–∫—Å–∫—É—Ä—Å–∏—é?")
    item4 = types.KeyboardButton("–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã")
    markup.add(item1, item2, item3, item4)

    bot.send_message(
        message.chat.id,
        f"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {message.from_user.first_name}!\n\n"
        f"–Ø - <b>{bot.get_me().first_name}</b>, –±–æ—Ç –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –†–µ—Å–ø—É–±–ª–∏–∫–∏ –ë—É—Ä—è—Ç–∏—è.\n\n"
        "–Ø –ø–æ–º–æ–≥—É –≤–∞–º —É–∑–Ω–∞—Ç—å –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö –Ω–∞—à–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, "
        "–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —ç–∫—Å–∫—É—Ä—Å–∏–∏.\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –≤–∞—Å –ø—É–Ω–∫—Ç –≤ –º–µ–Ω—é üëá",
        parse_mode='html', reply_markup=markup
    )

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
@bot.message_handler(content_types=['text'])
def handle_text(message):
    user_input = message.text.strip()
    match = get_closest_match(user_input)

    if match:
        bot.send_message(
            message.chat.id,
            FAQ_ANSWERS[match]["answer"],
            parse_mode='html'
        )
    else:
        bot.send_message(
            message.chat.id,
            "ü§î –ò–∑–≤–∏–Ω–∏—Ç–µ, —è –Ω–µ –ø–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É—Ç–æ—á–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –∏–∑ –º–µ–Ω—é.",
        )

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
if __name__ == "__main__":
    try:
        bot.polling(none_stop=True)
    except ConnectionError as e:
        print('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ', e)
    except Exception as r:
        print("–ù–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: ", r)
    finally:
        print("–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞.")
